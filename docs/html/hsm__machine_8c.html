<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>hsm-statechart: hsm/hsm_machine.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">hsm-statechart
   &#160;<span id="projectnumber">0.01</span>
   </div>
   <div id="projectbrief">An easy to use hierarchical state machine for C and C++</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('hsm__machine_8c.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">hsm_machine.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af82c374899ecc3b8faae4ec2a8f61a73"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#af82c374899ecc3b8faae4ec2a8f61a73">HSM_CONTEXT</a>(hsm)&#160;&#160;&#160;((hsm)-&gt;stack? (hsm)-&gt;stack-&gt;context: NULL)</td></tr>
<tr class="memitem:ae27734e5582668debb68db973903e2f9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#ae27734e5582668debb68db973903e2f9">PSEUDO_STATE</a>(Pseudo)</td></tr>
<tr class="memitem:ac60c7ee57c5f298f1893bb26620e25e4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#ac60c7ee57c5f298f1893bb26620e25e4">ERROR_IF_NULL</a>(x, msg)&#160;&#160;&#160;while(!x) { assert(msg); return HSM_FALSE; }</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a19d8d530a474ea86d492f817dec7741a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a19d8d530a474ea86d492f817dec7741a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>PSEUDO_STATE</b> (<a class="el" href="hsm__machine_8h.html#ab69ffd312882f9d46a7cec6d20bfe0c8">HsmStateTerminated</a>)</td></tr>
<tr class="memitem:a8aede98737cb5e60f8ed2c50cd000152"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8aede98737cb5e60f8ed2c50cd000152"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>PSEUDO_STATE</b> (<a class="el" href="hsm__machine_8h.html#a5574ce97f59edf4b77fafabc6ea36e54">HsmStateError</a>)</td></tr>
<tr class="memitem:ae2cacb5221fc4044f168b46b691c29d7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae2cacb5221fc4044f168b46b691c29d7"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>PSEUDO_STATE</b> (<a class="el" href="hsm__machine_8h.html#a3a16509f8bea2bca3f7b3f36525cc243">HsmStateHandled</a>)</td></tr>
<tr class="memitem:a1ba67e8e0edddad002d4f4c44d0e73db"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhsm__state__rec.html">hsm_state</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#a1ba67e8e0edddad002d4f4c44d0e73db">HsmTopState</a> ()</td></tr>
<tr class="memitem:a4c80274ec127bd85447ae22d8d3d39c3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#a4c80274ec127bd85447ae22d8d3d39c3">HsmMachine</a> (<a class="el" href="structhsm__machine.html">hsm_machine_t</a> *hsm, <a class="el" href="structhsm__context__stack.html">hsm_context_stack_t</a> *stack, hsm_callback_context_popped on_popped)</td></tr>
<tr class="memitem:ae8ac3aec6500cec0b5bb156c2fe0042d"><td class="memItemLeft" align="right" valign="top">hsm_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#ae8ac3aec6500cec0b5bb156c2fe0042d">HsmIsRunning</a> (<a class="el" href="structhsm__machine.html">hsm_machine_t</a> *hsm)</td></tr>
<tr class="memitem:a80dbefc8fc61614434d5f73525f12263"><td class="memItemLeft" align="right" valign="top">hsm_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#a80dbefc8fc61614434d5f73525f12263">HsmIsInState</a> (<a class="el" href="structhsm__machine.html">hsm_machine_t</a> *hsm, <a class="el" href="structhsm__state__rec.html">hsm_state</a> state)</td></tr>
<tr class="memitem:a44ff1ce2fd182dc518404da5f04a78ef"><td class="memItemLeft" align="right" valign="top">hsm_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#a44ff1ce2fd182dc518404da5f04a78ef">HsmStart</a> (<a class="el" href="structhsm__machine.html">hsm_machine_t</a> *hsm, <a class="el" href="structhsm__context.html">hsm_context_t</a> *ctx, <a class="el" href="structhsm__state__rec.html">hsm_state</a> first_state)</td></tr>
<tr class="memitem:ace2ab8e07c21e06d057628f36eb7e66b"><td class="memItemLeft" align="right" valign="top">hsm_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="hsm__machine_8c.html#ace2ab8e07c21e06d057628f36eb7e66b">HsmProcessEvent</a> (<a class="el" href="structhsm__machine.html">hsm_machine_t</a> *hsm, struct hsm_event *evt)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Copyright (c) 2012, everMany, LLC. All rights reserved.</p>
<p>All code licensed under the "New BSD" (BSD 3-Clause) License See License.txt for complete information. </p>
</div><hr/><h2>Macro Definition Documentation</h2>
<a class="anchor" id="af82c374899ecc3b8faae4ec2a8f61a73"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HSM_CONTEXT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">hsm</td><td>)</td>
          <td>&#160;&#160;&#160;((hsm)-&gt;stack? (hsm)-&gt;stack-&gt;context: NULL)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>macro for context stack refuseniks </p>

</div>
</div>
<a class="anchor" id="ae27734e5582668debb68db973903e2f9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PSEUDO_STATE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">Pseudo</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="structhsm__state__rec.html">hsm_state</a> _##Pseudo( <span class="keyword">struct</span> <a class="code" href="structhsm__machine.html">hsm_machine</a>* hsm, <span class="keyword">struct</span> <a class="code" href="structhsm__context.html">hsm_context</a>*ctx, <span class="keyword">struct</span> hsm_event*evt ) { \</div>
<div class="line">        return Pseudo(); \</div>
<div class="line">    } <a class="code" href="structhsm__state__rec.html">\</a></div>
<div class="line"><a class="code" href="structhsm__state__rec.html">    hsm_state</a> Pseudo() { \</div>
<div class="line">        static <span class="keyword">struct </span><a class="code" href="structhsm__state__rec.html">hsm_state_rec</a> info= { #Pseudo, _##Pseudo };\</div>
<div class="line">        return &amp;info;   \</div>
<div class="line">    }</div>
</div><!-- fragment --><p>macro for making a pseudostate:</p>
<ol type="1">
<li>a function that does nothing</li>
<li>a state info function to describe that state </li>
</ol>

</div>
</div>
<a class="anchor" id="ac60c7ee57c5f298f1893bb26620e25e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_IF_NULL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">msg&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;while(!x) { assert(msg); return HSM_FALSE; }</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>According to the <a href="http://www.w3.org/TR/scxml/#SelectingTransitions:">http://www.w3.org/TR/scxml/#SelectingTransitions:</a> I. """ The behavior of a transition with 'type' of "external" (the default) is defined in terms of the transition's source state (which is the state that contains the transition), the transition's target state(or states), and the Least Common Compound Ancestor (LCCA) of the source and target states When a transition is taken, the state machine will exit all active states that are proper descendants of the LCCA, starting with the innermost one(s) and working up to the immediate descendant(s) of the LCCA.</p>
<p>Then the state machine enters the target state(s), plus any states that are between it and the LCCA, starting with the outermost one (i.e., the immediate descendant of the LCCA) and working down to the target state(s).</p>
<p>As states are exited, their &lt;onexit&gt; handlers are executed. Then the executable content in the transition is executed, followed by the &lt;onentry&gt; handlers of the states that are entered. If the target state(s) of the transition is not atomic, the state machine will enter their default initial states recursively until it reaches an atomic state(s).</p>
<p>Note that the LCCA is neither entered nor exited."""</p>
<p>II. When target is a descendant of source.... "an internal transition will not exit and re-enter its source state, while an external one will."</p>
<p>III. """ [For] a &lt;transition&gt; whose target is its source state.... the state is exited and reentered, 
     triggering execution of its &lt;onentry&gt; and &lt;onexit&gt; executable content.""" </p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a1ba67e8e0edddad002d4f4c44d0e73db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhsm__state__rec.html">hsm_state</a> HsmTopState </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pseudo state for use with the HSM_STATE macros to represent the outer most state </p>
<dl class="section return"><dt>Returns:</dt><dd>the globally shared top most token. </dd></dl>

</div>
</div>
<a class="anchor" id="a4c80274ec127bd85447ae22d8d3d39c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structhsm__machine.html">hsm_machine_t</a>* HsmMachine </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td>
          <td class="paramname"><em>hsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhsm__context__stack.html">hsm_context_stack</a> *&#160;</td>
          <td class="paramname"><em>stack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">hsm_callback_context_popped&#160;</td>
          <td class="paramname"><em>popped_callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize a statemachine to its default values</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">hsm</td><td>Machine to initialize. </td></tr>
    <tr><td class="paramname">stack</td><td>Context stack used for per state instance data </td></tr>
    <tr><td class="paramname">popped_callback</td><td>Called every time a piece of context data gets popped due to state exit. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae8ac3aec6500cec0b5bb156c2fe0042d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hsm_bool HsmIsRunning </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td>
          <td class="paramname"><em>hsm</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Determine if a machine has been started, and has not reached a terminal, nor an error state.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">hsm</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>HSM_TRUE if running </dd></dl>

</div>
</div>
<a class="anchor" id="a80dbefc8fc61614434d5f73525f12263"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hsm_bool HsmIsInState </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td>
          <td class="paramname"><em>hsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhsm__state__rec.html">hsm_state</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Traverses the active state hierarchy to determine if hsm is possibly in the passed state.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">hsm</td><td></td></tr>
    <tr><td class="paramname">state</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a44ff1ce2fd182dc518404da5f04a78ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hsm_bool HsmStart </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td>
          <td class="paramname"><em>hsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhsm__context.html">hsm_context</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structhsm__state__rec.html">hsm_state</a>&#160;</td>
          <td class="paramname"><em>staet</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Start a machine.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">hsm</td><td>The machine to start. </td></tr>
    <tr><td class="paramname">context</td><td>Optional context for the entire machine. </td></tr>
    <tr><td class="paramname">state</td><td>The first state to move to. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>HSM_FALSE on error ( ex. the machine was already started ) </dd></dl>

</div>
</div>
<a class="anchor" id="ace2ab8e07c21e06d057628f36eb7e66b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">hsm_bool HsmProcessEvent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structhsm__machine.html">hsm_machine_t</a> *&#160;</td>
          <td class="paramname"><em>hsm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct hsm_event *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Send the passed event to the machine.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">hsm</td><td>The machine targeted. </td></tr>
    <tr><td class="paramname">event</td><td>A user defined event.</td></tr>
  </table>
  </dd>
</dl>
<p>The system will launch actions, trigger transitions, etc. </p>
<dl class="section return"><dt>Returns:</dt><dd>'true' if handled </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_6c36b64852547327283732128225c9d7.html">hsm</a></li><li class="navelem"><a class="el" href="hsm__machine_8c.html">hsm_machine.c</a></li>
    <li class="footer">Generated on Thu Jun 14 2012 18:18:51 for hsm-statechart by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.1.1 </li>
  </ul>
</div>
</body>
</html>
